<!DOCTYPE html>
<meta charset="utf-8"/>
<html>
	<head>
		<title>Maze Runner</title>
		<link rel="stylesheet" href="style.css">
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
		<script type="text/javascript">
			var host_ip = document.location.hostname;
			console.log("connecting to host: ", host_ip);

			//Get references to the html controls
			textbox_input1 = window.document.getElementById("my_text_box")
			//Connect to the server via websocket
      console.log("http://" + host_ip +":8080")
			var mysocket = io("http://" +host_ip +":8080");
			//Long lived frame object
			var last_frame;

			//-----------------------------------------
			//	CONNESSION ACKNOWLEDGE
			//-----------------------------------------
			//	Link is initiated by the client
			//	Server sends a welcome message when link is estabilished
			//	Server could send an auth token to keep track of individual clients and login data

			mysocket.on
			(
				"welcome",
				(message) =>
				{
					console.log("Server websocket connession acknoweldged... " +message.payload);
				}
			)

			//-----------------------------------------
			//	SERVER->CLIENT CONTROLS
			//-----------------------------------------
			//	Server can send an async message to dinamically update the page without reloading
			//	This is an example message with the server local date and time in string form

			mysocket.on
			(
				"server_time",
				(message) =>
				{
					// console.log(message)
					// fill_label( message.server_time );
					console.log("Server sent his local time... " +message.server_time);
				}
			)

			function fill_label( payload )
			{
        // console.log(te)
				console.log(textbox_input1)
				textbox_input1.value=payload;
			}

			//-----------------------------------------
			//	CLIENT->SERVER CONTROLS
			//-----------------------------------------
			//	Controls inside the webpage can emit async events to the server
			//	In this example I have a push button and I catch keyboard strokes

			//Handler for a pushbutton
			function socket_button_handler()
			{
				mysocket.emit("myclick", { payload: "button was clicked" });
				console.log("Button was clicked...");
			}

			//Listen for keystrokes
			window.document.addEventListener
			(
				"keypress",
				function onEvent(event)
				{
					//Inform the server that a key has been pressed
					mysocket.emit("keyboard", { payload: event.key });
					console.log("Key press...");
				}
			);

			//-----------------------------------------
			//	PING-PONG
			//-----------------------------------------
			//	Server sends ping messages with a timestamp
			//	Client answers with pongs to allow server to profile latency of the channel

			//profile messages means the server wants to compute roundway trip
			mysocket.on
			(
				"profile_ping",
				(message) =>
				{
					//Answer back with the received timestamp so that server can compute roundway trip
					mysocket.emit("profile_pong", { timestamp: message.timestamp });
					console.log( "server wants a pong. server absolute timestamp[ms]: " +message.timestamp );
				}
			);

		</script>
	</head>
	<body>

		<h1>Html+Css Server +low latency Websocket server</h1>
		<!-- button control with socket emitter as handler -->
		<p> This button will emit a websocket event. The server will be informed in real time of the event. </p>
		<button id="my_button" type="button" onclick="socket_button_handler()">Websocket Button!</button>

		<!-- input text control -->
		<p> This input can be filled through websockets directly by the server in real time </p>
		<input id="my_text_box" type="text" value="" size="40">

		<!-- canvas object, it's painted by the javascript video decoder -->
		<p> This canvas is painted by the javascript player and shows the live stream.'</p>
		<canvas id="video-canvas" width=640 height=480></canvas>
		<canvas id="video-canvas-1" width=640 height=480></canvas>
		<canvas id="video-canvas-2" width=640 height=480></canvas>
		<canvas id="video-canvas-3" width=640 height=480></canvas>


		<!-- Javascript video decoder, take in a data stream from a websocket and paint on a canvas -->
		<script type="text/javascript" src="jsmpeg.min.js"></script>
		<script type="text/javascript">
		var mycanvas = document.getElementById("video-canvas");
		var url = "ws://" + host_ip +":8082/";
		var player = new JSMpeg.Player(url, {canvas: mycanvas});
		

		
		var mycanvas1= document.getElementById("video-canvas-1");
		var url1 = "ws://" + host_ip +":8083/"
		var player1= new JSMpeg.Player(url, {canvas: mycanvas1});


		// var mycanvas2 = document.getElementById("video-canvas-2");
		// var url2 = "ws://" + host_ip +":8084/";
		// var player = new JSMpeg.Player(url, {canvas: mycanvas2});



		// var mycanvas3 = document.getElementById("video-canvas-3");
		// var url3 = "ws://" + host_ip +":8085/";
		// var player = new JSMpeg.Player(url, {canvas: mycanvas3});
		</script>
	</body>
</html>